/*1361243162,178142515*/

if (self.CavalryLogger) { CavalryLogger.start_js(["EvvXr"]); }

__d("StickyController",["Event","CSS","Style","Vector","copyProperties","queryThenMutateDOM"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('Style'),j=b('Vector'),k=b('copyProperties'),l=b('queryThenMutateDOM');function m(n,o,p,q){this._element=n;this._marginTop=o;this._onchange=p;this._proxy=q||n.parentNode;this._boundQueryOnScroll=this._queryOnScroll.bind(this);this._boundMutateOnScroll=this._mutateOnScroll.bind(this);}k(m.prototype,{handleScroll:function(){l(this._boundQueryOnScroll,this._boundMutateOnScroll);},_queryOnScroll:function(){this._shouldFix=j.getElementPosition(this._proxy,'viewport').y<=this._marginTop;},_mutateOnScroll:function(){var n=this._shouldFix;if(this.isFixed()!==n){i.set(this._element,'top',n?this._marginTop+'px':'');h.conditionClass(this._element,'fixed_elem',n);this._onchange&&this._onchange(n);}},start:function(){if(this._event)return;this._event=g.listen(window,'scroll',this.handleScroll.bind(this));this.handleScroll.bind(this).defer();},stop:function(){this._event&&this._event.remove();this._event=null;},isFixed:function(){return h.hasClass(this._element,'fixed_elem');}});e.exports=m;});
__d("TimelineSideAds",["function-extensions","Arbiter","CSS","DOM","Event","StickyController","TimelineConstants","TimelineController","UIPagelet","URI","Vector","cx","csx","debounce","ge"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('StickyController'),l=b('TimelineConstants'),m=b('TimelineController'),n=b('UIPagelet'),o=b('URI'),p=b('Vector'),q=b('cx'),r=b('csx'),s=b('debounce'),t=b('ge'),u=2,v=3,w=75,x='data-height',y=30000,z=0,aa=false,ba,ca,da,ea,fa=[],ga,ha=false,ia,ja=Infinity,ka=5,la=false,ma,na,oa,pa,qa,ra=false,sa=[],ta;function ua(nb,ob,pb){var qb=0;if(ob)qb+=ob.getHeight();if(!za()&&!qb)return;nb-=qb;var rb=0;for(var sb=0;sb<pb;sb++)rb+=fb(sb);if(ob)if(nb<rb){nb+=ob.fold(rb-nb);}else if(nb>rb)nb-=ob.unfold(nb-rb);return nb;}function va(){var nb=ca.cloneNode(true);nb.id='';var ob=true;i.scry(nb,'div.ego_unit').forEach(function(pb){if(ob){ob=false;}else i.remove(pb);});h.addClass(nb,'fixed_elem');return nb;}function wa(){if(!m.pageHasScrubber(ga)){ab(ka);db();}else if(na){bb(ca,false);var nb=oa;oa&&i.remove(oa);oa=va();if(nb)kb();ab(m.sidebarInitialized()&&ha?v:u);db();if(!ia){var ob=m.getCurrentScrubber();if(ob)jb(ob.getRoot(),ob.getOffset());}ia&&ia.start();}else mb.adjustAdsToFit();}function xa(){if(oa){i.remove(oa);oa=null;}if(ia){ia.stop();ia=null;}if(za()){h.conditionClass(ca,'fixed_elem',!na);h.conditionClass(ca,"_22s",!m.pageHasScrubber(ga));}else h.conditionClass(ca,'fixed_elem',!na&&m.pageHasScrubber(ga));}function ya(nb){var ob=p.getViewportDimensions().y,pb=m.getCurrentScrubber(),qb=pb?pb.getOffset():l.SCRUBBER_DEFAULT_OFFSET,rb=ob-qb-w;if(pb||za())return ua(rb,pb,nb);}function za(){return m.fixedAds();}function ab(nb){ea=Math.min(nb,fa.length);for(var ob=0;ob<fa.length;ob++)bb(fa[ob],ob>=ea);bb(ca,ea===0);}function bb(nb,ob){h.conditionClass(nb,"_22r",ob);nb.setAttribute('aria-hidden',ob?'true':'false');}function cb(nb){var ob=i.find(fa[nb],"div._4u8"),pb=ob.getAttribute('data-ad');return JSON.parse(pb).adid;}function db(){if(!pa)return;for(var nb=ea-1;nb>=0;--nb){if(ia&&ia.isFixed()&&((nb!==0)||(oa&&!h.shown(oa))))continue;var ob=cb(nb);if(!pa[ob])return;var pb=i.create('iframe',{src:o('/ai.php').addQueryData({aed:pa[ob]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});pb.setAttribute('aria-hidden','true');i.appendContent(ca,pb);delete pa[ob];}}function eb(nb){var ob=0;while(nb>0&&ob<ka){nb-=fb(ob);if(nb>=0)ob++;}return ob;}function fb(nb){var ob=fa[nb];if(!ob)return 0;if(!ob.getAttribute(x))gb(ob);return parseInt(ob.getAttribute(x),10);}function gb(nb){nb.setAttribute(x,nb.offsetHeight);}function hb(){for(var nb=0;nb<fa.length;nb++){var ob=fa[nb];if(!ob)continue;gb(ob);}}function ib(){fa=i.scry(ca,'div.ego_unit');var nb=fa.length;if(!nb)return;la=nb;wa();var ob=function(pb){gb(pb);la=--nb;mb.adjustAdsToFit();if(!la)ja=Date.now();};fa.forEach(function(pb){function qb(){ob.curry(pb).defer();}var rb=i.scry(pb,'img.img')[0];if(!rb)return;if(rb.complete){qb();}else j.listen(rb,{load:qb,error:qb,abort:qb});});}function jb(nb,ob){ia=new k(nb,ob,function(pb){if(pb){kb();}else{i.remove(oa);db();}});if(oa)ia.start();}function kb(){i.insertAfter(ca,oa);lb();}function lb(){h.conditionShow(oa,fb(0)<=ya(1)&&!h.hasClass(document.documentElement,'tinyViewport'));}var mb={init:function(nb,ob,pb){if(aa)return;ka=pb.max_ads;ba=pb.refresh_delay;y=pb.refresh_threshold;aa=true;da=ob;ca=nb;mb.adjustAdsType(m.shouldShowWideAds());qa=g.subscribe(['UFI/CommentAddedActive','UFI/CommentDeletedActive','UFI/LikeActive','Curation/Action','ProfileBrowser/LoadMoreContent','Ads/NewContentDisplayed'],mb.loadAdsIfEnoughTimePassed);ta=s(mb.loadAdsIfEnoughTimePassed,ba,this,true);if(pb.mouse_move){sa.push(j.listen(window,'mousemove',ta));sa.push(j.listen(window,'scroll',ta));sa.push(j.listen(window,'resize',ta));}m.register(m.ADS,mb);},setShortMode:function(nb){na=nb;},start:function(nb){pa=nb;ma=null;ib();},updateCurrentKey:function(nb){if(nb==ga)return;ga=nb;xa();},loadAds:function(nb){if(la||ma)return;ja=Infinity;ma=n.loadFromEndpoint('WebEgoPane',ca.id,{pid:33,data:[da,false,'timeline_'+nb,na?v:ka,++z]},{crossPage:true,bundle:false});},registerScrubber:function(nb){if(na)jb(nb.getRoot(),nb.getOffset());!ma&&mb.adjustAdsToFit();},loadAdsIfEnoughTimePassed:function(){if(y&&(Date.now()-ja>=y)&&!h.hasClass(document.documentElement,'tinyViewport')&&(!ia||ia.isFixed())&&(!pa||!pa[cb(0)]))mb.loadAds(ga);mb.adjustAdsToFit();},adjustAdsType:function(nb){if(nb!=ha){h.conditionClass(ca,"_22q",!nb);h.conditionClass(ca,"_35q",!nb);oa&&h.conditionClass(oa,"_22q",!nb);oa&&h.conditionClass(oa,"_35q",!nb);ha=nb;hb();mb.adjustAdsToFit();var ob=t('rightColContent');if(ob)h.conditionClass(ob,'fbTimelineWideRightCol',nb);}},adjustAdsToFit:function(){if(!ca||ra)return;ra=true;var nb=ha?v:u;if(na){if(ia&&oa){ia.handleScroll();if(ia.isFixed()){h.conditionShow(oa,fb(0)<=ya(1)&&!h.hasClass(document.documentElement,'tinyViewport'));}else ab(nb);db();}}else{var ob=ya(nb);if(typeof ob!=='undefined'){ab(eb(ob));if(!la)db();}}ra=false;},reset:function(){ia&&ia.stop();ma&&ma.cancel();fa=[];ha=false;ca=null;ia=null;ma=null;z=0;la=null;na=null;oa=null;ga=null;ja=Infinity;aa=false;qa&&g.unsubscribe(qa);qa=null;sa.forEach(function(nb){nb.remove();});sa=[];ta&&ta.reset();}};e.exports=a.TimelineSideAds||mb;});